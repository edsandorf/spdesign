<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Syntax • spdesign</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Syntax">
<meta property="og:description" content="spdesign">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdesign</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/generating-a-design.html">Generating a design</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/syntax.html">Syntax</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edsandorf/spdesign/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="syntax_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Syntax</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/edsandorf/spdesign/blob/master/vignettes/syntax.Rmd"><code>vignettes/syntax.Rmd</code></a></small>
      <div class="hidden name"><code>syntax.Rmd</code></div>

    </div>

    
    
<div id="syntax" class="section level1">
<h1 class="hasAnchor">
<a href="#syntax" class="anchor"></a>Syntax</h1>
<p>The syntax of <code>spdesign</code> is made to be intuitive and easy, while at the same time very flexible. To achieve this, we use a combination of regular expressions and R’s powerful expression parser “under the hood” to translate the user-specified utility functions into objects that can be manipulated by the package.</p>
<div id="specifying-a-parameter-with-a-prior" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-a-parameter-with-a-prior" class="anchor"></a>Specifying a parameter with a prior</h2>
<div id="a-fixed-prior" class="section level3">
<h3 class="hasAnchor">
<a href="#a-fixed-prior" class="anchor"></a>A fixed prior</h3>
<p>In <code>spdesign</code>, all parameters <em>must</em> have a prior. This is a deliberate design choice to make it clear that using a 0 prior is also an assumption in our design. The name of the parameter is followed by a square bracket, which contains the prior. All parameters have to start with <code>b_</code>. This is to separate them from attributes and to easily allow for non-linear utility functions. If no prior is specified for a given parameter, an error is returned. If the parameter is generic, i.e. it enters multiple utility expressions, then you only need to specify the prior once. If you specify more than one prior, only the first will be used and a warning is issued. It is strongly recommended that priors for generic parameters are specified the first time they are used (this is a good tip for attributes as well!).</p>
<p>For example, to specify a parameter <code>b_x1</code> with a prior of <code>0</code>, we would write:</p>
<pre><code>b_x1[0]</code></pre>
<p>Because we are leveraging R’s built-in parser, we can use basic mathematical operators to manipulate the values of our priors. For example, using the basic functions <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code> and <code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code>:</p>
<pre><code>b_x1[2 * 0.4]</code></pre>
<p>It is even possible to specify parameter priors as functions of earlier parameters. The only requirement is that the earlier parameter has been specified with a prior. In the example below, the prior value of <code>b_x2</code> is specified as half of <code>b_x1</code>.</p>
<pre><code>b_x1[0.5] * x_1 + b_x2[b_x1 / 2] * x_2</code></pre>
<p>If you try to specify multiple priors for a single parameter, e.g. <code>b_x1[c(0.1, 0.2)]</code>, a warning will be issued and only the first parameter value will be used. Specifying multiple priors for a single parameter is only valid if you are using the <code>_dummy</code> or <code>_effect</code> syntax to create dummy coded or effects coded variables, respectively.</p>
</div>
<div id="a-bayesian-prior" class="section level3">
<h3 class="hasAnchor">
<a href="#a-bayesian-prior" class="anchor"></a>A Bayesian prior</h3>
<p>We can specify a Bayesian prior by specifying the distribution of the prior. For example, <code><a href="../reference/normal.html">uniform_p(-1, 1)</a></code> means that we allow the prior to follow a uniform distribution between -1 and 1.</p>
<pre><code>b_x1[uniform_p(-1, 1)]</code></pre>
<p>We can use the following distributions:</p>
<ul>
<li>Normal - <code><a href="../reference/normal.html">normal_p(mean, sd)</a></code>
</li>
<li>Log-normal - <code><a href="../reference/normal.html">lognormal_p(mean, sd)</a></code>
</li>
<li>Triangular - <code><a href="../reference/normal.html">triangular_p(location, spread)</a></code>
</li>
<li>Uniform - <code><a href="../reference/normal.html">uniform_p(location, spread)</a></code>
</li>
</ul>
<p>All distributions are specified with a mean (location) or standard deviation (spread). In the case of the log-normal distribution we are specifying the mean and standard deviation of the underlying normal distribution. Notice that the name of the distribution is in capital letters followed by a lower case <code>p</code> indicating that it is a prior. This is to distinguish it from a random parameter in an RPL model. Bayesian priors are discussed in detail in the tutorial on advanced experimental designs.</p>
</div>
</div>
<div id="specifying-a-parameter-with-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-a-parameter-with-levels" class="anchor"></a>Specifying a parameter with levels</h2>
<div id="linear-attributes" class="section level3">
<h3 class="hasAnchor">
<a href="#linear-attributes" class="anchor"></a>Linear attributes</h3>
<p>The syntax for specifying attributes and levels is similar to how we specify parameters and priors. The attribute name is specified to the left and levels are specified inside <code>[]</code>. Below, the attribute <code>x_1</code> can take on the levels 1, 2, 3, 4 and 5.</p>
<pre><code>x_1[1:5]</code></pre>
<p>When we specify the levels, we can make use of R’s built in functions for generating sequences and vectors. For example, the following three specifications are identical:</p>
<pre><code># Specification 1
x_1[1:5]

# Specification 2
x_1[seq(1, 5, 1)]

# Specification 3
x_1[c(1, 2, 3, 4, 5)]</code></pre>
<p>However,</p>
<pre><code>x_1[1, 2, 3, 4, 5]</code></pre>
<p>is not a valid specification and will throw an error. The error will most likely be of the form:</p>
<pre><code>Error in parse(text = x) : &lt;text&gt;:1:2: unexpected ','
1: 1,
     ^ </code></pre>
<p>While we have not written a new intuitive error message for this misspecification, it will be caught by R’s parser and we feel that this is sufficient. As a compromise, we state the most likely error here to help users catch why their specifications fail.</p>
</div>
</div>
<div id="combining-parameters-priors-attributes-and-levels-to-form-a-utility-function" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-parameters-priors-attributes-and-levels-to-form-a-utility-function" class="anchor"></a>Combining parameters, priors, attributes and levels to form a utility function</h2>
<p>We combine the parameter and attribute as in the example below to start building our utility expression. We recommend that people use the naming convention <code>b_x1</code> being the parameter for the attribute <code>x1</code>. It has no practical implication for how the code works or interprets the utility function, but it makes it much easier for the user to see which parameter goes with which attribute. It is also important that the parameter <code>b_x1</code> preceeds the attribute <code>x1</code>. There is currently no checks written to ensure this, but failing to do so may cause unintended errors in certain instances. For example, if you are using the dummy- or effects-coding shorthand detailed below.</p>
<pre><code>b_x1[0] * x1[1:5]</code></pre>
</div>
<div id="advanced-syntax" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-syntax" class="anchor"></a>Advanced syntax</h2>
<div id="dummy-coded-attributes" class="section level3">
<h3 class="hasAnchor">
<a href="#dummy-coded-attributes" class="anchor"></a>Dummy-coded attributes</h3>
<p>We can specify an attribute to be dummy coded using the <code>_dummy</code> syntax.</p>
<pre><code>V = list(
  alt1 = b_x1_dummy[c(0.2, 0.5)] * x1[c(0, 1, 2)],
  alt2 = b_x1 * x1
)</code></pre>
<p>A few things to note about using the <code>_dummy</code> syntax (this is also true for <code>_effect</code> sytax, described below): 1) The priors and levels must be specified simultaneously. 2) You only need to use the <code>_dummy</code> syntax the when the prior is first specified. Importantly, this means that <code>b_x1_dummy</code> is used when the prior is specified and <code>b_x1</code> is used when referencing the parameters for the dummy coded attributes in the other utility functions. 3) You must specify one more level for the attribute than priors for the parameter.</p>
<p>In the case of the example above, it is identical to specifying:</p>
<pre><code>V = list(
  alt1 = b_x1_1[0.2] * x1_1[0, 1] + b_x1_2[0.5] * x1_2[0, 1],
  alt2 = b_x1_1 * x1_1 + b_x1_2 * x1_2
)
</code></pre>
<p>and implement the restriction that <code>x1_1</code> and <code>x1_2</code> cannot simultaneously be equal to 1. Under both specifications, estimates are relative to <code>x1 = 0</code>.</p>
</div>
<div id="effects-coded-attributes" class="section level3">
<h3 class="hasAnchor">
<a href="#effects-coded-attributes" class="anchor"></a>Effects-coded attributes</h3>
<p>We can specify an attribute to be effects coded using the <code>_effect</code> syntax.</p>
<p>It is important to note that effects and dummy coding are theoretically equivalent <span class="citation">(Daly, Dekker, and Hess <a href="#ref-daly_dummy_2016" role="doc-biblioref">2016</a>)</span>.</p>
</div>
</div>
</div>
<div id="mnl" class="section level1">
<h1 class="hasAnchor">
<a href="#mnl" class="anchor"></a>MNL</h1>
<div id="mnl-with-fixed-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#mnl-with-fixed-priors" class="anchor"></a>MNL with fixed priors</h2>
</div>
<div id="mnl-with-bayesian-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#mnl-with-bayesian-priors" class="anchor"></a>MNL with Bayesian priors</h2>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-daly_dummy_2016">
<p>Daly, Andrew, Thijs Dekker, and Stephane Hess. 2016. “Dummy Coding Vs Effects Coding for Categorical Variables: Clarifications and Extensions.” <em>Journal of Choice Modelling</em>, Standalone technical contributions in choice modelling, 21 (December): 36–41. <a href="https://doi.org/10.1016/j.jocm.2016.09.005">https://doi.org/10.1016/j.jocm.2016.09.005</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://edsandorf.me">Erlend Dancke Sandorf</a>, <a href="https://dannycampbell.me">Danny Campbell</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
