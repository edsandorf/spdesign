<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Syntax • spdesign</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Syntax">
<meta property="og:description" content="spdesign">
<meta property="og:image" content="https://spdesign.edsandorf.me/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdesign</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/syntax.html">Syntax</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edsandorf/spdesign/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Syntax</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/edsandorf/spdesign/blob/HEAD/vignettes/syntax.Rmd" class="external-link"><code>vignettes/syntax.Rmd</code></a></small>
      <div class="hidden name"><code>syntax.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="creating-a-design">Creating a design<a class="anchor" aria-label="anchor" href="#creating-a-design"></a>
</h2>
<p>The syntax of <code>spdesign</code> is made to be intuitive and easy,
while at the same time very flexible. To achieve this, we use a
combination of regular expressions and R’s powerful expression parser
“under the hood” to translate the user-specified utility functions into
objects that can be manipulated by the package.</p>
<p>It is impossible to write checks for all possible edge cases of
inputs. Therefore, you are strongly encouraged to follow the
recommendations in this manual carefully when defining your utility
functions.</p>
<div class="section level3">
<h3 id="specifying-a-prior">Specifying a prior<a class="anchor" aria-label="anchor" href="#specifying-a-prior"></a>
</h3>
<div class="section level4">
<h4 id="a-fixed-prior">A fixed prior<a class="anchor" aria-label="anchor" href="#a-fixed-prior"></a>
</h4>
<p>In <code>spdesign</code>, all parameters <em>must</em> have a prior.
This is a deliberate design choice to make it clear that using a 0 prior
is also an assumption in our design. The name of the prior is followed
by a square bracket, which contains the assumed value of the prior. All
priors have to start with <code>b_</code>. This is to separate them from
attributes and to easily allow for non-linear utility functions.</p>
<p>If no prior is specified for a given parameter, an error is returned.
If the parameter is generic, i.e. it enters multiple utility
expressions, then you only need to specify the prior once. It is
strongly recommended that priors for generic parameters are specified
the first time they are used (this is a good tip for attributes as
well!).</p>
<p>For example, to specify a parameter <code>b_x1</code> with a prior of
<code>0</code>, we would write:</p>
<pre><code><span><span class="va">b_x1</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="a-bayesian-prior">A Bayesian prior<a class="anchor" aria-label="anchor" href="#a-bayesian-prior"></a>
</h4>
<p>We can specify a Bayesian prior by specifying the distribution of the
prior. For example, <code>uniform_p(-1, 1)</code> means that we allow
the prior to follow a uniform distribution between -1 and 1.</p>
<pre><code><span><span class="st">"b_x1[uniform_p(-1, 1)]"</span></span></code></pre>
<p>We can use the following distributions:</p>
<ul>
<li>Normal - <code>normal_p(mean, sd)</code>
</li>
<li>Log-normal - <code>lognormal_p(mean, sd)</code>
</li>
<li>Triangular - <code>triangular_p(location, spread)</code>
</li>
<li>Uniform - <code>uniform_p(min, max)</code>
</li>
</ul>
<p>All distributions are specified with a mean (location) or standard
deviation (spread). In the case of the log-normal distribution we are
specifying the mean and standard deviation of the underlying normal
distribution.</p>
</div>
</div>
<div class="section level3">
<h3 id="specifying-a-parameter-with-levels">Specifying a parameter with levels<a class="anchor" aria-label="anchor" href="#specifying-a-parameter-with-levels"></a>
</h3>
<div class="section level4">
<h4 id="linear-attributes">Linear attributes<a class="anchor" aria-label="anchor" href="#linear-attributes"></a>
</h4>
<p>The syntax for specifying attributes and levels is similar to how we
specify parameters and priors. The attribute name is specified to the
left and levels are specified inside <code>[]</code>. Below, the
attribute <code>x_1</code> can take on the levels 1, 2, 3, 4 and 5.</p>
<pre><code><span><span class="st">"x1[1:5]"</span></span></code></pre>
<p>When we specify the levels, we can make use of R’s built in functions
for generating sequences and vectors. For example, the following three
specifications are identical:</p>
<pre><code><span><span class="co"># Specification 1</span></span>
<span><span class="st">"x1[1:5]"</span></span>
<span></span>
<span><span class="co"># Specification 2</span></span>
<span><span class="st">"x1[seq(1, 5, 1)]"</span></span>
<span></span>
<span><span class="co"># Specification 3</span></span>
<span><span class="st">"x1[c(1, 2, 3, 4, 5)]"</span></span></code></pre>
<p>However,</p>
<pre><code><span><span class="st">"x1[1, 2, 3, 4, 5]"</span></span></code></pre>
<p>is not a valid specification and will throw an error. The error will
most likely be of the form:</p>
<pre><code>Error in parse(text = x) : &lt;text&gt;:1:2: unexpected ','
1: 1,
     ^ </code></pre>
<p>While we have not written a new intuitive error message for this
misspecification, it will be caught by R’s parser and we feel that this
is sufficient. As a compromise, we state the most likely error here to
help users catch why their specifications fail.</p>
<p><em>Important:</em> Make sure that all attribute levels are numeric.
Even in the cases where you use the <code>_dummy</code> coding syntax it
is <strong>always</strong> safer to use numeric values for the
levels.</p>
</div>
</div>
<div class="section level3">
<h3 id="combining-parameters-priors-attributes-and-levels-to-form-a-utility-function">Combining parameters, priors, attributes and levels to form a
utility function<a class="anchor" aria-label="anchor" href="#combining-parameters-priors-attributes-and-levels-to-form-a-utility-function"></a>
</h3>
<p>We combine the parameter and attribute as in the example below to
start building our utility expression. We recommend that people use the
naming convention <code>b_x1</code> being the parameter for the
attribute <code>x1</code>. It has no practical implication for how the
code works or interprets the utility function, but it makes it much
easier for the user to see which parameter goes with which attribute. It
is also important that the parameter <code>b_x1</code> precedes the
attribute <code>x1</code>. There is currently no checks written to
ensure this, but failing to do so may cause unintended errors in certain
instances. For example, if you are using the dummy-coding shorthand
detailed below.</p>
<p>Below is an example:</p>
<pre><code><span><span class="st">"b_x1[0] * x1[1:5]"</span></span></code></pre>
<p>It is <strong>strongly</strong> recommended to use identical names
for priors and attributes, with the exception of “b_” for priors. This
makes reading of the code easier.</p>
</div>
<div class="section level3">
<h3 id="building-a-set-of-utility-functions">Building a set of utility functions<a class="anchor" aria-label="anchor" href="#building-a-set-of-utility-functions"></a>
</h3>
<p>The utility functions take the form of named lists. Let’s say that we
would like to create a design comprising two alternatives with three
attributes each and a status quo. We want our first attribute to take on
the five levels 1, 2, 3, 4, and 5; our second attribute to take on the
levels 0 and 1; and our third attribute to take on the values betwween 0
and 1 in .25 increments. One way to specify this would be the
following:</p>
<pre><code><span><span class="va">utility</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  alt1 <span class="op">=</span> <span class="st">"b_x1[0.1]  * x1[1:5] + b_x2[0.4] * x2[c(0, 1)] + b_x3[-0.2] * x3[seq(0, 1, 0.25)]"</span>,</span>
<span>  alt2 <span class="op">=</span> <span class="st">"b_x1       * x1      + b_x2      * x2          + b_x3       * x3"</span>,</span>
<span>  alt3 <span class="op">=</span> <span class="st">"b_sq[0.15] * sq[1]"</span></span>
<span><span class="op">)</span></span></code></pre>
<p>Where the status quo or opt out alternative has a single constant. It
is important that when you add constants the level is 1. You cannot
currently specify specific levels of the attributes for the SQ. Since
these do not vary, this is equivalent to a constant (which can be
calculated beforehand, see more details below) because only differences
in utility matter for the model.</p>
</div>
<div class="section level3">
<h3 id="generating-a-design">Generating a design<a class="anchor" aria-label="anchor" href="#generating-a-design"></a>
</h3>
<p>To generate a design, we need to pass the utility function along with
other options to the <code>generate_design</code> function. Currently,
we can only generate designs for the MNL model. To see the full set of
options for the function: <code><a href="../reference/generate_design.html">?generate_design</a></code>.</p>
<pre><code><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_design.html">generate_design</a></span><span class="op">(</span><span class="va">utility</span>, rows <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                          model <span class="op">=</span> <span class="st">"mnl"</span>, efficiency_criteria <span class="op">=</span> <span class="st">"d-error"</span>,</span>
<span>                          algorithm <span class="op">=</span> <span class="st">"rsc"</span>, draws <span class="op">=</span> <span class="st">"scrambled-sobol"</span>,</span>
<span>                          control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                            max_iter <span class="op">=</span> <span class="fl">21000</span></span>
<span>                          <span class="op">)</span><span class="op">)</span></span></code></pre>
<p>The list <code>control</code> contains options that can be passed
along to the function to change default values. The default values and
options are:</p>
<pre><code><span>  <span class="va">default_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    max_iter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    max_relabel <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    max_swap <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    efficiency_threshold <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    sample_with_replacement <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre>
<div class="section level4">
<h4 id="algorithms-and-attribute-level-balance">Algorithms and attribute level balance<a class="anchor" aria-label="anchor" href="#algorithms-and-attribute-level-balance"></a>
</h4>
<p>No default algorithm for generating a design is implemented because
they have different properties with respect to how easy it is to achieve
attribute level balance (see more details below) and how easy it is to
include restrictions/exclusions in the design (see more details below).
Three algorithms are implemented: <code>rsc</code>,
<code>federov</code>, and <code>random</code>.</p>
<p>The <code>rsc</code> algorithm creates an initial design candidate
based on the provided attributes, levels and number of rows. This design
candidate is attribute level balanced by default (if the number of
attribute levels for all attributes are a multiple of the number of
rows) or near attribute level balanced. It will not deviate from this.
It finds new candidates by relabling or swapping attribute levels. The
default is to cycle between relabling and swapping each 10000
candidates. The cycling part of the algorithm is not included because it
is rarely used in practice. You cannot include restrictions or
exclusions in your design when using the <code>rsc</code> algorithm. For
details: <code><a href="../reference/rsc.html">?rsc</a></code></p>
<p>The <code>federov</code> and <code>random</code> algorithms will
systematically or randomly select potential design candidates from the
candidate set. The candidate set can be either supplied or assumed to be
the full factorial. These algorithms completely lets go of attribute
level balance and you do run the risk of some attribute levels not
showing up in the final design. We show syntax below to include level
occurrence restrictions below. You can easily include restrictions in
your design using these to algorithms by excluding attribute level
combinations from the candidate set. That way, they will never be part
of the design.</p>
<p>Note that in general, both restrictions and attribute level balance
may lead to less efficient designs and that if your restrictions are too
tight and you are trying to force attribute level balance, no designs
may be found. Few checks are made to notify the user of this.</p>
</div>
</div>
<div class="section level3">
<h3 id="blocking-the-design">Blocking the design<a class="anchor" aria-label="anchor" href="#blocking-the-design"></a>
</h3>
<p>Blocking the design is done after the design has been generate and
will add a blocking column to the design. The following will block the
design into 4 trying to minimize the average squared correlation between
the blocking column and each of the design columns. More information:
<code><a href="../reference/block.html">?block</a></code></p>
<pre><code><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block.html">block</a></span><span class="op">(</span><span class="va">design</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="summary-of-the-design-">Summary of the design.<a class="anchor" aria-label="anchor" href="#summary-of-the-design-"></a>
</h3>
<p>The design object is stored as a list of class <code>spdesign</code>.
Individual parts can be accessed using the <code>$</code> operator.
Functions such as <code>summary</code>, <code>coef</code>,
<code>print</code>, <code>vcov</code> and <code>cor</code> all work as
expected.</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-syntax">Advanced syntax<a class="anchor" aria-label="anchor" href="#advanced-syntax"></a>
</h2>
<div class="section level3">
<h3 id="attribute-level-balance">Attribute level balance<a class="anchor" aria-label="anchor" href="#attribute-level-balance"></a>
</h3>
<p>As stated above, the <code>rsc</code> algorithm wil ensure attribute
level balance, whereas the <code>federov</code> and <code>random</code>
algorithms will not. However, there is some flexibility in how this is
specified. The following will only work for the <code>federov</code> and
<code>random</code> algorithms and will be ignored without warning if
the <code>rsc</code> algorithm is used.</p>
<p>The implicit restriction in the package is that each attribute level
can occur between 0 and <code>rows</code> number of times. For example,
if you have a design with 20 rows, then the attribute level can occur
between 0 and 20 times. In practice, anywhere between never and always.
The package does provide the user with the ability to specify a narrower
range.</p>
<p>To do this, we would specify a parenthesis behind the attribute
levels where we give the range that the attribute levels can take.
Assume that our design has 18 rows. The following specification would
force attribute level balance by saying that each level has to occur
exactly 6 times.</p>
<pre><code><span><span class="st">"b_x1[0] * x1[c(0, 1, 2)](6)"</span></span></code></pre>
<p>As stated, it is not always possible to get attribute level balance
and indeed it can be quite hard with the <code>federov</code> and
<code>random</code> algorithms. Specifying a range may be better. For
example, we could specify that all attribute levels should occur between
5 and 7 times.</p>
<pre><code><span><span class="st">"b_x1[0] * x1[c(0, 1, 2)](5:7)"</span></span></code></pre>
<p>In very special cases, it may be desirable to let some attribute
levels occur more frequently than others and we could specify:</p>
<pre><code><span><span class="st">"b_x1[0] * x1[c(0, 1, 2)](3:5, 5:7, 6:9)"</span></span></code></pre>
<p>which would mean that 0 occurs between 3 and 5 times, 1 between 5 and
7, and 2 between 6 and 9 times. Indeed, in the case where we only
specify a single range, it is expanded to be equal to the number of
attribute levels such that:</p>
<pre><code><span><span class="st">"b_x1[0] * x1[c(0, 1, 2)](5:7)"</span></span></code></pre>
<p>is equivalent to</p>
<pre><code><span><span class="st">"b_x1[0] * x1[c(0, 1, 2)](5:7, 5:7, 5:7)"</span></span></code></pre>
<p>A few important things to note:</p>
<ol style="list-style-type: decimal">
<li>The sum of minimum level occurrences must be less than
<code>rows</code> and the sum of maximum level occurrences must be
larger than <code>rows</code>. Otherwise, no design can be found. <em>No
checks</em> are implemented for this.</li>
<li>You can only specify either a single number or range, or number or
ranges equal to the number of levels. Deviating from this may have
unintended consequences and <em>no checks</em> are implemented.</li>
<li>You can only specify the number of times an attribute should occur
in the design at the same time as you specify the number of levels,</li>
</ol>
</div>
<div class="section level3">
<h3 id="interactions">Interactions<a class="anchor" aria-label="anchor" href="#interactions"></a>
</h3>
<p>If you believe that there are interaction effects between attributes
in your model, then these will have to be considered at the design
stage. Any design that is not a full factorial assumes that some higher
order interaction effects are insignificant. To ensure that you are able
to identify the effect of an interaction in your data, this will have to
be included in the design. To include an interaction term in the design,
we can use the following syntax.</p>
<pre><code><span><span class="st">"b_x1[0] * x1[c(0, 1)] + b_x2 * x2[c(0, 1)] + b_x1x2 * I(x1 * x2)"</span></span></code></pre>
<p>Two things to note about the specification of the utility function
with interactions. First, the levels of the attributes are specified
when the attribute is first introduced and not in the interaction term
itself, and two, for the parser to correctly interpret an interaction
term, it needs to be wrapped in R’s internal function for handling
interactions <code><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="dummy-coded-attributes">Dummy-coded attributes<a class="anchor" aria-label="anchor" href="#dummy-coded-attributes"></a>
</h3>
<p>Often we have attributes in mind that are categorical in nature,
e.g., comfort or environmental quality. In the design, it is often
desirable to let these be dummy-coded. We can easily specify an
attribute to dummy-coded using the <code>_dummy</code> syntax. Assume
that we have a single categorical attribute that can take on three
levels. We would then specify the utility functions as follows:</p>
<pre><code><span><span class="va">V</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  alt1 <span class="op">=</span> <span class="st">"b_x1_dummy[c(0.2, 0.5)] * x1[c(1, 2, 3)]"</span>,</span>
<span>  alt2 <span class="op">=</span> <span class="st">"b_x1_dummy * x1"</span></span>
<span><span class="op">)</span></span></code></pre>
<p>Here we have specified 2 priors and 3 levels. The dummy coding
expands the attribute levels by transforming the attribute into a factor
and expanding it using a formula and the model.matrix. The first level
is chosen as the baseline and dropped. Similarly, the priors are
expanded into separate priors for each level. This also works with
Bayesian priors.</p>
<p>It is recommended to use 1, 2, 3, 4 for the levels of a dummy-coded
attribute. Note that the levels don’t matter, but this naming convention
secures that there is a correspondence between the names for the priors
and attributes.</p>
<p>A few things to note about using the <code>_dummy</code> syntax</p>
<ol style="list-style-type: decimal">
<li>The priors and levels must be specified simultaneously.</li>
<li>You must specify one more level for the attribute than priors for
the parameter.</li>
<li>You cannot use <code>_dummy</code> as an extension for your
attribute name.</li>
<li>If you are using specified levels for the status-quo or opt out
alternative, make sure that this corresponds to the base level and is
coded as a 0. See more details below.</li>
</ol>
</div>
<div class="section level3">
<h3 id="constrained-designs">Constrained designs<a class="anchor" aria-label="anchor" href="#constrained-designs"></a>
</h3>
<p>When using the <code>federov</code> or <code>random</code>
algorithms, we can pass along a list of exclusions to
<code>generate_design</code>. The exclusions will exclude the specified
combinations from the full factorial prior to generating design
candidates. The exclusions take the form of an unamed list of strings.
You must ensure that the names of the list corresponds to the names of
the expanded attribute levels (see
<code><a href="../reference/expand_attribute_levels.html">?expand_attribute_levels</a></code>).</p>
<p>For example:</p>
<pre><code><span><span class="va">exclusions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"alt1_x1 == 2 &amp; alt1_x2 == 0 &amp; alt1_x3 == 0"</span>,</span>
<span>  <span class="st">"alt2_x2 == 1 &amp; alt2_x3 == 1"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="specifying-constants-and-levels-of-the-sq-alternative">Specifying constants and levels of the SQ alternative<a class="anchor" aria-label="anchor" href="#specifying-constants-and-levels-of-the-sq-alternative"></a>
</h3>
<p>You cannot currently specify fixed SQ levels. Specifying new
attributes that can only take on a single level for the SQ leads to a
computationally singular Hessian matrix (because there is no variation).
To get around this, you can calculate what the size of the SQ constant
would be given the defined attribute levels for the SQ and the assumed
prior and include this as a single constant for the SQ alternative. This
will ensure that the correct utility differences are used in the
design.</p>
<p>A fix with additional level restrictions will be included in a future
version of the package.</p>
<p>Remember, that when you specify fixed levels for the SQ, you cannot
also specify alternative specific constants for the non-SQ alternatives.
This is a violation of the J-1 ‘rule’ and will result in a singular
Fisher information matrix.</p>
<p>There is no point specifying SQ levels that only take on the value of
0. These have no bearing on the design and may be problematic when
inverting the Fisher information matrix.</p>
<p>Related to the above point, in the case where your attribute is
dummy-coded the easiest is to define it such that the base level of your
dummy-coded attribute corresponds to the level of the SQ. Remember, that
in your design, these only take on the values of 1 and 0 with the base
level being zero for all non-base-level levels. Defining the base level
to be equal to the SQ obviates the need to explicitly specify the SQ
beyond a constant.</p>
</div>
<div class="section level3">
<h3 id="large-designs">Large designs<a class="anchor" aria-label="anchor" href="#large-designs"></a>
</h3>
<p>Creating large designs can be beneficial, however, if you have many
attributes and levels, the size of the full factorial can be too large
to hold in memory leading to an error of the type: “Error: vector memory
exhausted (limit reached)”. There are two possible solutions to fix
this:</p>
<ol style="list-style-type: decimal">
<li>You can supply a candidate set that is of a sufficient size</li>
<li>You can use the <code>rsc</code> algorithm instead, which will
obviate the need to have the full factorial present.</li>
</ol>
</div>
<div class="section level3">
<h3 id="supplying-a-candidate-set">Supplying a candidate set<a class="anchor" aria-label="anchor" href="#supplying-a-candidate-set"></a>
</h3>
<p>You can supply a candidate set to use with the modified federov and
random design algorithms. There are 2 important things with respect to
the candidate set that <code>spdesign</code> will check for:</p>
<ol style="list-style-type: decimal">
<li>That the names are compliant with the package. This means that the
names of the variables in the supplied candidate set must follow a
specific naming convention. The name consists of two parts: i) the name
of the utility function, which are the names given to each utility
function element in the list of utility functions, and ii) the name of
the attribute. These are combined using an underscore giving the
following format: <utility func>_<attr>. For example, if you have the
following set of utility functions:</attr></utility>
</li>
</ol>
<pre><code><span><span class="va">V</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  alt1 <span class="op">=</span> <span class="st">"b_x1_dummy[c(0.2, 0.5)] * x1[c(1, 2, 3)]"</span>,</span>
<span>  alt2 <span class="op">=</span> <span class="st">"b_x1_dummy * x1"</span></span>
<span><span class="op">)</span></span></code></pre>
<p>Then the column names of the candidate set would be:
<code>alt1_x1</code> and <code>alt2_x1</code>.</p>
<ol start="2" style="list-style-type: decimal">
<li>That all attribute levels specified in the utility functions are in
the candidate set. A mismatch here will result in an error.</li>
<li>That there are not more (unneccesasry) columns in the candidate set
that are not used by the utility expression. This is caught by an error
message.</li>
</ol>
<p>The candidate set is passed in as a <code>data.frame</code> using the
<code>candidate_set</code> argument to the function
<code>generate_design</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://edsandorf.me" class="external-link">Erlend Dancke Sandorf</a>, <a href="https://dannycampbell.me" class="external-link">Danny Campbell</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
